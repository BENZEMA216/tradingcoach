# original_data - 原始数据目录

存放用户上传的原始交易数据文件，作为系统的数据输入源。

## 设计思路

原始数据保持不变，系统仅读取不修改：

```
original_data/
├── README.md                           # 本文档
└── 历史-保证金综合账户*.csv            # 券商导出的交易记录
```

## 数据来源

### 支持的券商

| 券商 | 文件格式 | 编码 |
|------|----------|------|
| 富途证券 | CSV | UTF-8 BOM |

### 文件命名规则

```
历史-保证金综合账户(账户ID)-导出时间.csv
示例: 历史-保证金综合账户(2663)-20251103-231527.csv
```

## CSV 字段说明

| 字段名 | 说明 | 示例 |
|--------|------|------|
| 方向 | 交易方向 | 买入、卖出 |
| 代码 | 证券代码 | AAPL、00700 |
| 名称 | 证券名称 | 苹果、腾讯控股 |
| 订单价格 | 委托价格 | 150.00 |
| 订单数量 | 委托数量 | 100 |
| 成交价格 | 实际成交价 | 150.05 |
| 成交数量 | 实际成交数量 | 100 |
| 下单时间 | 委托时间 | 2025/11/03 09:38:46 (美东) |
| 成交时间 | 成交时间 | 2025/11/03 09:38:47 (美东) |
| 合计费用 | 总手续费 | 2.50 |
| 佣金 | 券商佣金 | 1.00 |
| 平台使用费 | 平台费 | 0.50 |
| 交收费 | 清算费 | 0.30 |
| 证监会费用 | SEC 费用 | 0.02 |
| 交易活动费 | TAF 费用 | 0.01 |
| 市场 | 交易市场 | 美股、港股 |
| 币种 | 结算货币 | USD、HKD |

## 数据处理流程

```
原始 CSV → CsvParser → DataCleaner → Trade 模型 → 数据库
           (解析)      (清洗)        (转换)       (存储)
```

### 解析规则

1. **编码处理**: 使用 `utf-8-sig` 读取 UTF-8 BOM 文件
2. **字段映射**: 中文字段名映射为英文属性
3. **时区转换**: 解析 `(美东)` 等时区标记，统一转 UTC
4. **数值清洗**: 处理逗号分隔的数字、空值

## 使用方法

### 导入新数据

```bash
# 导入单个文件
python scripts/import_trades.py --file original_data/历史-保证金综合账户*.csv

# 预览模式
python scripts/import_trades.py --file original_data/历史-保证金综合账户*.csv --dry-run
```

### 数据要求

- 必须包含所有必填字段（方向、代码、成交价格、成交数量、成交时间）
- 时间格式需包含时区信息
- 金额字段需为有效数值

## 数据安全

⚠️ **重要提示**:

1. **备份原始文件**: 导入前保留备份
2. **敏感信息**: 账户 ID 可能包含敏感信息
3. **版本控制**: 建议将大文件加入 `.gitignore`

## 扩展支持

计划支持更多数据源：

- [ ] 老虎证券 CSV
- [ ] 盈透证券 FlexQuery
- [ ] 雪盈证券
- [ ] 手动输入界面
