# 交易复盘报告系统 - 产品需求文档 (PRD)

**版本**: v1.0
**日期**: 2025-11-12
**状态**: Manually Checked

---

## 1. 产品概述

### 1.1 产品定位

AI 驱动的个人交易复盘工具，通过深度分析历史交易数据，帮助投资者系统性地总结交易经验、识别交易模式、发现优势与不足，最终提升交易决策质量和长期收益。

### 1.2 核心价值主张

- **全面复盘**：从单笔交易到周期性表现，从日常操作到重大事件应对，多维度覆盖
- **AI 洞察**：自动识别交易模式、行为习惯、重复性错误和成功经验
- **对话式分析**：通过自然语言与 AI 对话，灵活探索交易数据中的深层信息
- **数据驱动**：基于量化指标和可视化图表，客观评估交易表现
- **持续改进**：建立从复盘到改进的闭环，将洞察转化为可执行的行动计划

### 1.3 目标用户

**主要用户**：个人投资者（自用）
- 拥有一定交易经验（本项目基于过去一年的交易记录）
- 交易市场：美股、期权、港股、Crypto
- 希望系统化地提升交易水平
- 愿意通过数据分析和复盘来改进决策

---

## 2. 核心功能模块

### 2.1 单笔交易复盘

**目标**：深度分析单笔交易的完整过程，发现决策和执行中的问题和亮点

**功能要点**：
- **交易时间轴**：从建仓、持仓到平仓的完整过程可视化
- **决策分析**
  - 进场理由和依据（用户可手动标注或 AI 辅助推断） - 高优
  - 进场时机评估（技术面、基本面、市场环境）
  - 仓位选择合理性
- **执行分析**
  - 订单类型选择（限价/市价）
  - 滑点分析（订单价格 vs 成交价格） - 低优
  - 持仓期间的行情走势
  - 止损/止盈执行情况
- **结果分析**
  - 盈亏金额和比例
  - 与预期的对比
  - 费用占比
- **AI 洞察**
  - 识别执行中的情绪决策（如追涨杀跌、过早止盈）
  - 对比历史类似交易
  - 改进建议

**交互设计**：
- 交易卡片：列表形式展示所有交易，支持筛选和排序（支持按盈亏排序、最值得分析排序等智能排序方式）
- 详情页：点击进入单笔交易的详细分析页面

### 2.2 周期性复盘报告

**目标**：按时间周期汇总交易表现，识别趋势和周期性模式

**支持的周期**：
- 日报
- 周报
- 月报
- 季度报告
- 年度报告

**功能要点**：

#### 2.2.1 绩效概览
- 总盈亏、总收益率
- 交易次数、胜率
- 最大单笔盈利/亏损
- 最大回撤
- 夏普比率、索提诺比率

#### 2.2.2 交易行为分析
- 交易频率分布（日内/swing/中长线）
- 持仓时间统计
- 交易时段分析（盘前/盘中/盘后）
- 星期几效应（是否某些日子表现更好，可以结合中西方玄学分析）

#### 2.2.3 标的分析
- 按标的统计盈亏
- 行业/板块表现
- 股票 vs 期权表现对比 vs 其他类别标的
- 持仓集中度

#### 2.2.4 费用分析
- 总费用和占收益比例
- 费用分解（佣金、平台费、交易费等）
- 过度交易检测

#### 2.2.5 趋势分析
- 盈亏曲线（累计收益曲线）
- 胜率变化趋势
- 交易频率变化
- 风险指标变化

#### 2.2.6 对比分析
- 与基准指数对比（如 SPY）
- 与上一周期对比
- 同比/环比分析

**交互设计**：
- 时间选择器：快速切换周期
- 仪表盘：关键指标卡片展示
- 图表区：交互式图表（折线图、柱状图、饼图、热力图等）
- 下钻功能：从周期报告点击进入具体交易详情

### 2.3 大事件复盘

**目标**：分析重大事件前后的交易应对和表现

**支持的事件类型**：

#### 2.3.1 财报财季
- 持仓标的财报发布前后的操作
- 财报交易的胜率和盈亏
- 是否有效利用财报行情

#### 2.3.2 市场剧烈波动
- 大涨大跌日（如 VIX 指数飙升）
- 黑天鹅事件（如 2020 年 3 月疫情暴跌）
- 在极端行情中的应对策略

#### 2.3.3 重大盈亏交易
- 单笔盈利/亏损超过设定阈值（如 $500 或账户的 5%）
- 这些交易的共性分析
- 极端盈亏后的心态和下一笔交易分析

#### 2.3.4 策略转换点
- 交易风格变化的时期（如从日内转向 swing）
- 策略调整的效果评估

#### 2.3.5 政治事件
- 大选、美联储议息、地缘政治等
- 与标的相关的监管、政策变化

**功能要点**：
- **事件时间轴**：标记事件发生时间，叠加交易记录
- **前后对比**：事件前 N 天 vs 事件后 N 天的表现对比
- **行为模式**：是否在事件前提前布局、事件后追涨杀跌
- **AI 识别**：自动从新闻、市场数据中识别相关事件（后期功能）

**交互设计**：
- 事件日历：标记重要事件
- 事件卡片：点击查看该事件的详细分析
- 手动添加：用户可以手动标记事件

### 2.4 AI 对话式分析 （先实现其他功能再执行）

**目标**：通过自然语言对话，灵活探索交易数据，获取定制化洞察

**功能要点**：

#### 2.4.1 对话界面
- 类似 ChatGPT 的聊天窗口
- 支持连续对话，保持上下文

#### 2.4.2 支持的问题类型
- **事实查询**
  - "我在 AMZN 上总共赚了多少钱？"
  - "我最长持仓时间的交易是哪一笔？"
  - "我在 10 月份的胜率是多少？"
- **趋势分析**
  - "我的交易频率是在增加还是减少？"
  - "我最近的盈亏波动是否在变大？"
- **模式识别**
  - "我是否有追涨杀跌的习惯？"
  - "我在什么情况下容易亏损？"
  - "我的获利交易有什么共同点？"
- **对比分析**
  - "我在期权和股票上的表现有什么区别？"
  - "我上个月和这个月的表现对比如何？"
- **原因探索**
  - "为什么我在 11 月初亏损较多？"
  - "我的最大回撤是什么原因造成的？"
- **建议请求**
  - "我应该如何改进我的止损策略？"
  - "基于我的交易历史，你有什么建议？"

#### 2.4.3 AI 响应方式
- 文字回答 + 数据支撑（表格、数字）
- 动态生成图表
- 引用具体交易案例
- 提供可操作的建议

#### 2.4.4 技术实现
- 使用 LLM（如 GPT-4, Claude）+ RAG（检索增强生成）
- 将交易数据向量化存储
- 结合预计算的指标和实时查询

### 2.5 自定义时间段分析

**目标**：用户自由选择任意时间范围进行分析（锦上添花功能）

**功能要点**：
- 日期范围选择器
- 自动生成该时间段的完整报告（类似周期性报告）
- 对比参照时间段（可选）

---

## 3. 分析指标体系

### 3.1 盈亏指标

#### 3.1.1 基础盈亏指标
- **总盈亏 (Total P&L)**：所有已平仓交易的盈亏总和
- **总收益率 (Total Return)**：总盈亏 / 初始资金
- **已实现盈亏**：已平仓部分
- **未实现盈亏**：未平仓部分（需要实时行情数据）

#### 3.1.2 交易统计
- **总交易次数**：完整交易（买入 + 卖出）的次数
- **盈利交易次数**：盈利的交易数量
- **亏损交易次数**：亏损的交易数量
- **胜率 (Win Rate)**：盈利交易次数 / 总交易次数 × 100%

#### 3.1.3 盈亏分布
- **平均盈利 (Avg Win)**：所有盈利交易的平均盈利额
- **平均亏损 (Avg Loss)**：所有亏损交易的平均亏损额
- **盈亏比 (Win/Loss Ratio)**：平均盈利 / 平均亏损
- **最大单笔盈利 (Max Win)**
- **最大单笔亏损 (Max Loss)**
- **盈利交易占比 (% Profitable)**

#### 3.1.4 风险调整后收益
- **夏普比率 (Sharpe Ratio)**：(平均收益率 - 无风险利率) / 收益率标准差
- **索提诺比率 (Sortino Ratio)**：(平均收益率 - 无风险利率) / 下行波动率
- **卡玛比率 (Calmar Ratio)**：年化收益率 / 最大回撤

#### 3.1.5 回撤指标
- **最大回撤 (Max Drawdown)**：从峰值到谷值的最大跌幅
- **最大回撤期 (Max Drawdown Duration)**：从峰值到恢复峰值的时间
- **当前回撤 (Current Drawdown)**：当前账户相对历史最高点的回撤

### 3.2 交易行为分析

#### 3.2.1 交易频率
- **日均交易次数**
- **交易频率分布**：日内/短线(1-5天)/中线(5-30天)/长线(>30天)
- **交易活跃度**：交易日占比

#### 3.2.2 持仓时间
- **平均持仓时间**
- **中位数持仓时间**
- **持仓时间分布直方图**
- **盈利交易 vs 亏损交易的持仓时间对比**

#### 3.2.3 交易时段
- **盘前/盘中/盘后交易占比**
- **各时段的盈亏表现**
- **交易时间热力图**（星期几 × 小时）

#### 3.2.4 交易规模
- **平均单笔交易金额**
- **交易金额分布**
- **是否有仓位管理规则**（金额标准差）

#### 3.2.5 进出场纪律
- **滑点统计**：订单价格 vs 成交价格
- **限价单 vs 市价单使用比例**
- **部分成交比例**
- **订单取消率**

#### 3.2.6 交易习惯模式
- **追涨杀跌倾向**：买入时标的涨跌幅统计
- **割肉/止盈果断程度**：亏损/盈利后的平均持有时间
- **加仓/减仓行为**

### 3.3 风险管理指标

#### 3.3.1 仓位管理
- **平均仓位使用率**：交易金额 / 账户总资金
- **最大仓位使用率**
- **仓位集中度**：单一标的占比、行业占比

#### 3.3.2 止损执行
- **设定止损的交易占比**（需要用户标注或规则识别）
- **止损执行率**：实际执行止损 / 触及止损
- **平均止损幅度**
- **止损后的下一步操作**（是否报复性交易）

#### 3.3.3 风险暴露
- **单笔最大风险敞口**
- **日内最大风险敞口**
- **相关性风险**：同时持有高度相关的标的

#### 3.3.4 极端情况应对
- **大跌日(-3%以上)的操作**：抄底/止损/观望
- **大涨日(+3%以上)的操作**：追涨/止盈/持有
- **账户大幅波动时的反应**

### 3.4 成本分析

#### 3.4.1 交易费用
- **总费用**：佣金 + 平台费 + 监管费等
- **费用占收益比**：总费用 / 总盈亏
- **费用占交易额比**：总费用 / 总交易额
- **单笔平均费用**

#### 3.4.2 费用分解
- 佣金
- 平台使用费
- 交收费
- 印花税（如适用）
- 交易费
- 监管费用
- 其他费用

#### 3.4.3 费用影响分析
- **费用侵蚀收益的幅度**
- **过度交易检测**：高频交易是否被费用吃掉利润
- **费用优化建议**

#### 3.4.4 滑点成本
- **平均滑点**
- **滑点对盈亏的影响**
- **市价单 vs 限价单的滑点对比**

### 3.5 市场环境因素

#### 3.5.1 技术指标关联
（需要获取标的历史行情数据）
- **进场时的技术指标状态**
  - RSI、MACD、布林带位置等
- **与技术指标的相关性分析**
  - 例如：在 RSI > 70 时买入的胜率

#### 3.5.2 市场情绪
- **市场波动率 (VIX) 与交易表现**
- **大盘走势与个人交易表现**
  - 牛市/熊市/震荡市的适应性
- **行业热点与交易选择**

#### 3.5.3 基本面因素
（需要补充数据）
- **财报前后的交易表现**
- **新闻事件对交易的影响**

---

## 4. AI 功能设计

### 4.1 自动洞察生成

**目标**：AI 主动分析数据，生成报告式洞察，无需用户提问

**洞察类型**：

#### 4.1.1 表现总结
- "本周你共交易 12 次，胜率 58.3%，总盈利 $342.5，表现优于上周。"
- "你在 AMZN 上累计盈利 $1,250，是你最成功的标的。"

#### 4.1.2 模式识别
- "你在周五下午的交易胜率仅为 35%，远低于平均水平，建议减少周五尾盘操作。"
- "你持仓超过 3 天的交易胜率高达 72%，而日内交易胜率仅 45%，考虑调整交易风格。"

#### 4.1.3 问题警示
- "你最近 5 笔亏损交易都是在盘前交易，这可能是一个需要关注的问题。"
- "你在大幅亏损后的下一笔交易中，65% 的情况下会继续亏损，可能存在情绪化交易。"

#### 4.1.4 优势识别
- "你在科技股上的胜率高达 68%，明显优于其他板块，这是你的优势领域。"
- "你对 TSLA 的交易时机把握很好，7 次交易中 6 次盈利。"

#### 4.1.5 改进建议
- "建议：你的平均止损幅度为 -8.5%，而盈利平均为 +5.2%，盈亏比不佳。考虑让利润奔跑，及时止损。"
- "建议：你的交易频率在月末显著增加，但胜率下降，可能是过度交易，建议保持交易纪律。"

**实现方式**：
- 预定义规则引擎：基于阈值和条件触发洞察
- LLM 生成：将统计结果输入 LLM，生成自然语言描述
- 优先级排序：重要洞察优先展示

### 4.2 模式识别算法

**目标**：从数据中挖掘隐藏的交易习惯和行为模式

**识别维度**：

#### 4.2.1 时间模式
- 星期几效应
- 月初/月末效应
- 特定时间段表现异常

#### 4.2.2 连续性模式
- 连胜/连亏后的下一笔交易表现
- 情绪化交易检测（报复性交易）
- 追涨杀跌模式

#### 4.2.3 标的选择模式
- 偏好某些股票/行业
- 对热点追逐的频率
- 重复交易同一标的的结果

#### 4.2.4 执行模式
- 止盈止损一致性
- 加仓/减仓触发条件
- 持仓时间与盈亏的关系

**技术方案**：
- 统计分析：相关性、假设检验
- 聚类分析：将交易分组
- 时间序列分析：识别周期性
- 机器学习：分类模型预测交易结果

### 4.3 对比分析能力

**对比维度**：

#### 4.3.1 时间对比
- 周环比、月环比、年同比
- 与历史最佳/最差时期对比

#### 4.3.2 策略对比
- 不同交易风格（日内 vs swing）的表现
- 不同标的类型（股票 vs 期权）的表现

#### 4.3.3 标的对比
- 各标的的盈亏贡献
- 各行业的表现

#### 4.3.4 基准对比
- 与大盘指数（SPY, QQQ）对比
- 与 Buy & Hold 策略对比

**可视化**：
- 对比表格
- 雷达图
- 并列柱状图

### 4.4 优势与问题识别

**优势识别**：
- 高胜率的标的、行业、时间段
- 成功的交易模式
- 稳定的盈利来源
- 良好的风险控制案例

**问题识别**：
- 反复犯的错误
- 高亏损的场景
- 纪律性问题（未执行止损、过度交易等）
- 情绪化决策迹象

**输出形式**：
- 优势清单 + 案例
- 问题清单 + 案例
- 改进建议和行动计划

---

## 5. 用户界面与交互

### 5.1 交互式网页设计原则

- **直观性**：数据可视化为主，减少文字堆砌
- **交互性**：图表可点击、筛选、下钻
- **响应性**：支持桌面和平板设备
- **美观性**：清晰的布局，专业的配色

### 5.2 主要页面和功能区

#### 5.2.1 首页 / 仪表盘 (Dashboard)
- 关键指标卡片（总盈亏、胜率、交易次数等）
- 近期趋势图（盈亏曲线）
- AI 洞察卡片（3-5 条关键洞察）
- 快速入口：周期报告、单笔交易、AI 对话

#### 5.2.2 交易列表 (Trade List)
- 表格形式展示所有交易
- 列：日期、标的、方向、盈亏、持仓时间、标签等
- 筛选：按标的、日期范围、盈亏状态、标签
- 排序：按日期、盈亏、持仓时间等
- 点击行进入单笔交易详情页

#### 5.2.3 单笔交易详情页
- 交易时间轴
- 关键信息展示（进场/出场价格、持仓时间、盈亏等）
- 期间行情走势图（如有数据）
- AI 分析和建议
- 用户笔记和标签编辑区

#### 5.2.4 周期性报告页
- 时间周期选择器（日/周/月/季/年）
- 日期范围选择器
- 多个分析模块（可滚动查看）
  - 绩效概览
  - 盈亏曲线
  - 交易行为分析
  - 标的分析
  - 费用分析
  - AI 洞察
- 导出报告按钮（PDF / 图片）

#### 5.2.5 大事件复盘页
- 事件日历视图
- 事件列表（手动添加 + AI 识别）
- 点击事件进入详情
  - 事件描述
  - 前后交易列表
  - 前后对比图表
  - AI 分析

#### 5.2.6 AI 对话页
- 聊天窗口（左右布局或单列布局）
- 输入框 + 发送按钮
- 对话历史
- 快捷提问按钮（预设常见问题）
- 动态图表渲染区

#### 5.2.7 设置页
- 数据导入/更新
- 偏好设置
  - 基准指数选择
  - 风险阈值设置
  - 重大盈亏定义
- AI 设置（如 API key）
- 数据导出

### 5.3 数据可视化方案

#### 5.3.1 图表类型
- **折线图**：盈亏曲线、趋势分析
- **柱状图**：交易次数、盈亏分布
- **饼图**：标的占比、行业分布
- **散点图**：持仓时间 vs 盈亏
- **热力图**：交易时间分布、相关性矩阵
- **箱线图**：盈亏分布统计
- **K 线图**：标的行情走势（如有数据）

#### 5.3.2 交互功能
- 悬停显示详细数据
- 点击筛选/下钻
- 缩放和拖拽
- 图例显示/隐藏

#### 5.3.3 颜色规范
- 盈利：绿色
- 亏损：红色
- 中性：灰色/蓝色
- 警示：黄色/橙色

---

## 6. 技术架构（概要）

### 6.1 技术栈建议

#### 6.1.1 后端
- **语言**：Python 3.10+
- **数据处理**：pandas, numpy
- **数据库**：SQLite（MVP）或 PostgreSQL
- **AI 模型**：
  - LLM API：OpenAI GPT-4 / Anthropic Claude
  - 向量数据库：ChromaDB / Pinecone（用于 RAG）
- **Web 框架**：FastAPI（API 服务）

#### 6.1.2 前端
- **框架**：React / Vue.js
- **图表库**：ECharts / Plotly / Recharts
- **UI 组件库**：Ant Design / Material-UI
- **状态管理**：Redux / Zustand

#### 6.1.3 部署
- **MVP**：本地运行（Jupyter Notebook + Streamlit 快速原型）
- **生产环境**：
  - 前端：Vercel / Netlify
  - 后端：AWS / GCP / 自建服务器
  - 容器化：Docker

### 6.2 系统架构

```
┌─────────────────────────────────────────────────────────┐
│                     前端 (Web UI)                        │
│   - Dashboard  - Trade List  - Reports  - AI Chat       │
└────────────────────┬────────────────────────────────────┘
                     │ HTTP/WebSocket
┌────────────────────▼────────────────────────────────────┐
│                  API 服务层 (FastAPI)                    │
│   - 数据查询 API  - 分析计算 API  - AI 对话 API          │
└────────────────────┬────────────────────────────────────┘
                     │
      ┌──────────────┼──────────────┐
      │              │              │
┌─────▼─────┐ ┌─────▼─────┐ ┌─────▼─────┐
│  数据层    │ │  分析引擎  │ │  AI 层     │
│           │ │           │ │           │
│ - SQLite  │ │ - 指标计算 │ │ - LLM API │
│ - CSV     │ │ - 模式识别 │ │ - RAG     │
│           │ │ - 统计分析 │ │ - Prompts │
└───────────┘ └───────────┘ └───────────┘
```

### 6.3 数据流

1. **数据导入**：CSV → 解析 → 清洗 → 入库
2. **数据处理**：原始数据 → 衍生字段 → 交易配对 → 指标计算
3. **查询展示**：前端请求 → API 查询 → 返回数据/图表配置 → 渲染
4. **AI 对话**：用户问题 → 向量检索 → 构建 Prompt → LLM 生成 → 返回答案

---

## 7. MVP 范围界定

### 7.1 MVP（第一版）必须实现的功能

**目标**：基于现有的一年交易数据，生成可用的复盘报告

#### 7.1.1 数据层
- ✅ 导入 CSV 数据
- ✅ 数据清洗和标准化
- ✅ 基础字段解析
- ✅ 简单的交易配对逻辑（同标的买卖匹配）

#### 7.1.2 分析功能
- ✅ 基础盈亏指标计算（总盈亏、胜率、盈亏比等）
- ✅ 交易行为分析（持仓时间、交易频率）
- ✅ 费用分析
- ✅ 单笔交易详情展示

#### 7.1.3 报告功能
- ✅ 周期性报告（至少支持月报）
- ✅ 交易列表和筛选
- ✅ 单笔交易详情页

#### 7.1.4 可视化
- ✅ 盈亏曲线图
- ✅ 交易次数柱状图
- ✅ 盈亏分布图
- ✅ 基础仪表盘

#### 7.1.5 AI 功能（简化版）
- ✅ 基于规则的自动洞察生成（3-5 条关键洞察）
- ⚠️ AI 对话功能（简化版，支持基础问答）

#### 7.1.6 部署
- ✅ 本地运行（Jupyter Notebook 或 Streamlit）

### 7.2 第二版（迭代）功能

#### 7.2.1 增强分析
- 风险管理指标（最大回撤、夏普比率等）
- 大事件复盘功能
- 更复杂的交易配对逻辑（分批建仓/平仓）

#### 7.2.2 增强 AI
- 完整的 AI 对话功能（RAG + LLM）
- 模式识别算法（机器学习模型）
- 更智能的洞察生成

#### 7.2.3 数据增强
- 集成实时行情数据（用于未实现盈亏和技术指标分析）
- 集成财报、新闻数据

#### 7.2.4 交互增强
- 用户标注功能（笔记、标签、评分）
- 报告导出（PDF）
- 数据对比功能

### 7.3 未来规划

- 实时交易监控和提醒
- 策略回测功能
- 多账户支持
- 社区分享和对比
- 移动端应用

---

## 8. 成功指标

### 8.1 产品成功指标

- **功能完整性**：MVP 功能全部实现且可用
- **数据准确性**：指标计算准确无误
- **用户满意度**：个人使用体验良好，能够从复盘中获得价值
- **AI 有效性**：AI 洞察真实有用，不是泛泛而谈

### 8.2 个人成长指标

- 通过复盘，识别出至少 3 个需要改进的问题
- 通过复盘，发现至少 2 个自己的优势领域
- 后续交易中，胜率或盈亏比有所提升（6 个月后评估）

---

## 9. 风险和挑战

### 9.1 数据质量
- **风险**：CSV 数据可能存在缺失、错误
- **应对**：完善数据清洗逻辑，增加数据验证

### 9.2 交易配对复杂性
- **风险**：分批建仓、部分平仓等复杂场景难以准确配对
- **应对**：MVP 阶段简化处理，后续迭代优化

### 9.3 AI 准确性
- **风险**：AI 生成的洞察可能不准确或无意义
- **应对**：结合规则引擎和 LLM，人工审核关键洞察

### 9.4 技术实现难度
- **风险**：全栈开发工作量大，可能超出预期
- **应对**：MVP 阶段使用 Streamlit 等低代码工具快速原型，后续再优化

### 9.5 隐私和数据安全
- **风险**：交易数据敏感，需要保护
- **应对**：本地运行，不上传云端；如使用 LLM API，脱敏处理

---

## 10. 附录

### 10.1 术语表
- **盈亏比 (Win/Loss Ratio)**：平均盈利 / 平均亏损
- **最大回撤 (Max Drawdown)**：从峰值到谷值的最大跌幅百分比
- **夏普比率 (Sharpe Ratio)**：衡量风险调整后收益的指标
- **滑点 (Slippage)**：订单价格与实际成交价格的差异
- **RAG (Retrieval-Augmented Generation)**：检索增强生成，一种结合知识库检索和 LLM 的 AI 技术

---

**文档结束**

**下一步行动**：
1. 评审和完善 PRD - 已完成
2. 设计数据库 Schema
3. 开发 MVP 数据处理模块
4. 开发 MVP 分析引擎
5. 开发 MVP UI（Streamlit）
6. 测试和迭代