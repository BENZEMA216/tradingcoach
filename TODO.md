# 交易复盘报告系统 - 开发任务清单

**项目**: Trading Coach - AI 驱动的个人交易复盘工具
**PRD 版本**: v1.0
**TODO 创建日期**: 2025-11-12
**状态说明**:
- ⬜ 未开始
- 🔄 进行中
- ✅ 已完成
- ⚠️ 阻塞/待定
- 🔖 优先级高

---

## 📋 开发路线图概览

### Phase 1: 基础设施和数据层 (MVP 核心)
### Phase 2: 核心分析引擎
### Phase 3: 基础 UI 界面
### Phase 4: 单笔交易复盘
### Phase 5: 周期性报告
### Phase 6: AI 功能（简化版）
### Phase 7: 第二阶段迭代
### Phase 8: 未来规划

---

## Phase 1: 基础设施和数据层 🔖

### 1.1 项目初始化
- [ ] ⬜ 创建项目目录结构
- [ ] ⬜ 初始化 Git 仓库（已完成）
- [ ] ⬜ 创建 Python 虚拟环境
- [ ] ⬜ 安装基础依赖包 (pandas, numpy, etc.)
- [ ] ⬜ 创建 requirements.txt
- [ ] ⬜ 设置代码格式化工具 (black, flake8)

### 1.2 数据导入模块
- [ ] ⬜ 实现 CSV 文件读取功能（处理 UTF-8-sig 编码）
- [ ] ⬜ 数据字段映射（中文字段 → 英文字段）
- [ ] ⬜ 数据类型转换（日期、数字、字符串）
- [ ] ⬜ 数据验证逻辑（缺失值、异常值检测）
- [ ] ⬜ 单元测试：数据导入模块

### 1.3 数据清洗和标准化
- [ ] ⬜ 处理缺失值（填充或删除）
- [ ] ⬜ 处理重复记录
- [ ] ⬜ 标准化交易方向（买入/卖出 → buy/sell）
- [ ] ⬜ 标准化币种和金额
- [ ] ⬜ 时区处理（下单时间、成交时间）
- [ ] ⬜ 单元测试：数据清洗模块

### 1.4 数据库设计
- [ ] ⬜ 设计数据库 Schema
  - [ ] ⬜ transactions 表（原始交易记录）
  - [ ] ⬜ trades 表（配对后的完整交易）
  - [ ] ⬜ securities 表（标的信息）
  - [ ] ⬜ tags 表（用户标签）
  - [ ] ⬜ notes 表（用户笔记）
- [ ] ⬜ 创建 SQLite 数据库
- [ ] ⬜ 实现 ORM 模型（SQLAlchemy）
- [ ] ⬜ 数据库迁移脚本
- [ ] ⬜ 数据导入脚本（CSV → SQLite）

### 1.5 交易配对逻辑
- [ ] ⬜ 简单配对算法（同标的 FIFO 匹配）
  - [ ] ⬜ 识别买入和卖出订单
  - [ ] ⬜ 按时间顺序配对
  - [ ] ⬜ 计算持仓时间
  - [ ] ⬜ 计算盈亏
- [ ] ⬜ 处理部分成交情况
- [ ] ⬜ 处理未平仓交易
- [ ] ⬜ 单元测试：交易配对模块
- [ ] ⚠️ 复杂配对逻辑（分批建仓/平仓）- 第二阶段

---

## Phase 2: 核心分析引擎 🔖

### 2.1 基础盈亏指标计算
- [ ] ⬜ 总盈亏 (Total P&L)
- [ ] ⬜ 总收益率 (Total Return)
- [ ] ⬜ 已实现盈亏
- [ ] ⬜ 总交易次数
- [ ] ⬜ 盈利/亏损交易次数
- [ ] ⬜ 胜率 (Win Rate)
- [ ] ⬜ 平均盈利 (Avg Win)
- [ ] ⬜ 平均亏损 (Avg Loss)
- [ ] ⬜ 盈亏比 (Win/Loss Ratio)
- [ ] ⬜ 最大单笔盈利/亏损
- [ ] ⬜ 单元测试：盈亏指标计算

### 2.2 交易行为分析
- [ ] ⬜ 日均交易次数
- [ ] ⬜ 交易频率分布（日内/短线/中线/长线）
- [ ] ⬜ 平均持仓时间
- [ ] ⬜ 中位数持仓时间
- [ ] ⬜ 持仓时间分布直方图
- [ ] ⬜ 盈利 vs 亏损交易的持仓时间对比
- [ ] ⬜ 交易时段分析（盘前/盘中/盘后）
- [ ] ⬜ 交易时间热力图（星期几 × 小时）
- [ ] ⬜ 单元测试：交易行为分析

### 2.3 费用分析
- [ ] ⬜ 总费用统计
- [ ] ⬜ 费用占收益比
- [ ] ⬜ 费用占交易额比
- [ ] ⬜ 单笔平均费用
- [ ] ⬜ 费用分解（佣金、平台费、交收费等）
- [ ] ⬜ 过度交易检测逻辑
- [ ] ⬜ 单元测试：费用分析

### 2.4 标的分析
- [ ] ⬜ 按标的统计盈亏
- [ ] ⬜ 交易次数最多的标的 Top 10
- [ ] ⬜ 盈利最多的标的 Top 10
- [ ] ⬜ 亏损最多的标的 Top 10
- [ ] ⬜ 股票 vs 期权表现对比
- [ ] ⬜ 单元测试：标的分析

### 2.5 时间序列分析
- [ ] ⬜ 累计盈亏曲线计算
- [ ] ⬜ 按周期统计（日/周/月/季/年）
- [ ] ⬜ 胜率变化趋势
- [ ] ⬜ 交易频率变化趋势
- [ ] ⬜ 单元测试：时间序列分析

### 2.6 风险管理指标 (第二优先级)
- [ ] ⚠️ 最大回撤 (Max Drawdown) - MVP 需要
- [ ] ⚠️ 当前回撤
- [ ] ⚠️ 夏普比率 (Sharpe Ratio)
- [ ] ⚠️ 索提诺比率 (Sortino Ratio)
- [ ] ⚠️ 卡玛比率 (Calmar Ratio)

---

## Phase 3: 基础 UI 界面（Streamlit MVP）🔖

### 3.1 Streamlit 项目初始化
- [ ] ⬜ 安装 Streamlit
- [ ] ⬜ 创建主应用文件 (app.py)
- [ ] ⬜ 设置页面配置（标题、图标、布局）
- [ ] ⬜ 侧边栏导航菜单

### 3.2 数据导入界面
- [ ] ⬜ 文件上传组件
- [ ] ⬜ 数据预览组件
- [ ] ⬜ 数据加载进度条
- [ ] ⬜ 数据统计概览（行数、字段数）

### 3.3 仪表盘页面
- [ ] ⬜ 关键指标卡片（总盈亏、胜率、交易次数）
- [ ] ⬜ 盈亏曲线图（折线图）
- [ ] ⬜ 交易次数柱状图
- [ ] ⬜ 盈亏分布饼图

### 3.4 数据可视化配置
- [ ] ⬜ 选择图表库（Plotly / Altair / ECharts）
- [ ] ⬜ 定义颜色规范（盈利=绿色，亏损=红色）
- [ ] ⬜ 创建可复用的图表组件
- [ ] ⬜ 图表交互功能（悬停、缩放）

---

## Phase 4: 单笔交易复盘功能

### 4.1 交易列表页面
- [ ] ⬜ 表格展示所有交易
  - [ ] ⬜ 列：日期、标的、方向、价格、数量、盈亏、持仓时间
- [ ] ⬜ 筛选功能
  - [ ] ⬜ 按标的筛选
  - [ ] ⬜ 按日期范围筛选
  - [ ] ⬜ 按盈亏状态筛选（盈利/亏损）
- [ ] ⬜ 排序功能
  - [ ] ⬜ 按日期排序
  - [ ] ⬜ 按盈亏排序
  - [ ] ⬜ 按持仓时间排序
- [ ] ⬜ 分页功能

### 4.2 单笔交易详情页
- [ ] ⬜ 交易基本信息卡片
  - [ ] ⬜ 标的名称和代码
  - [ ] ⬜ 进场/出场时间
  - [ ] ⬜ 进场/出场价格
  - [ ] ⬜ 交易数量
  - [ ] ⬜ 持仓时间
  - [ ] ⬜ 盈亏金额和比例
- [ ] ⬜ 交易时间轴可视化
- [ ] ⬜ 费用明细展示
- [ ] ⬜ 用户笔记编辑区（第二优先级）
- [ ] ⬜ 用户标签添加功能（第二优先级）

### 4.3 单笔交易分析
- [ ] ⬜ 订单类型分析（限价/市价）
- [ ] ⬜ 滑点分析（订单价格 vs 成交价格）- 低优
- [ ] ⬜ 与历史类似交易对比（第二优先级）

---

## Phase 5: 周期性报告功能 🔖

### 5.1 周期选择器
- [ ] ⬜ 时间周期选择（日/周/月/季/年）
- [ ] ⬜ 日期范围选择器
- [ ] ⬜ 快捷时间选择（本周/本月/本季/本年）

### 5.2 绩效概览模块
- [ ] ⬜ 关键指标卡片布局
- [ ] ⬜ 总盈亏、总收益率
- [ ] ⬜ 交易次数、胜率
- [ ] ⬜ 最大单笔盈利/亏损
- [ ] ⬜ 最大回撤（如已实现）

### 5.3 交易行为分析模块
- [ ] ⬜ 交易频率分布图
- [ ] ⬜ 持仓时间统计图
- [ ] ⬜ 交易时段分析图
- [ ] ⬜ 星期几效应分析（可结合玄学分析）

### 5.4 标的分析模块
- [ ] ⬜ 按标的盈亏统计表
- [ ] ⬜ 标的盈亏分布饼图
- [ ] ⬜ 股票 vs 期权表现对比图
- [ ] ⬜ 交易次数 Top 10 标的

### 5.5 费用分析模块
- [ ] ⬜ 总费用展示
- [ ] ⬜ 费用占收益比
- [ ] ⬜ 费用分解饼图
- [ ] ⬜ 过度交易警告提示

### 5.6 趋势分析模块
- [ ] ⬜ 累计收益曲线图
- [ ] ⬜ 胜率变化趋势图
- [ ] ⬜ 交易频率变化图

### 5.7 报告导出功能（第二优先级）
- [ ] ⚠️ 导出为 PDF
- [ ] ⚠️ 导出为图片
- [ ] ⚠️ 导出为 Excel

---

## Phase 6: AI 功能（简化版 MVP）

### 6.1 基于规则的自动洞察生成
- [ ] ⬜ 定义洞察规则引擎
  - [ ] ⬜ 表现总结规则（如"本周盈利 $XXX"）
  - [ ] ⬜ 警示规则（如"连续 5 笔亏损"）
  - [ ] ⬜ 优势识别规则（如"某标的胜率 >70%"）
  - [ ] ⬜ 问题识别规则（如"某时间段胜率 <40%"）
- [ ] ⬜ 实现洞察生成函数
- [ ] ⬜ 洞察优先级排序
- [ ] ⬜ 在仪表盘展示 3-5 条关键洞察

### 6.2 AI 对话功能（简化版）
- [ ] ⚠️ 选择 LLM API（OpenAI GPT-4 / Anthropic Claude）
- [ ] ⚠️ 实现基础对话界面（Streamlit Chat）
- [ ] ⚠️ 实现预设问题快捷按钮
- [ ] ⚠️ 支持基础问答（事实查询）
  - [ ] ⚠️ "我在 AMZN 上赚了多少钱？"
  - [ ] ⚠️ "我 10 月份的胜率是多少？"
- [ ] ⚠️ 将分析结果转化为 Prompt 输入
- [ ] ⚠️ 测试对话准确性

---

## Phase 7: 第二阶段迭代功能

### 7.1 大事件复盘功能
- [ ] ⚠️ 事件类型定义
  - [ ] ⚠️ 财报财季
  - [ ] ⚠️ 市场剧烈波动
  - [ ] ⚠️ 重大盈亏交易
  - [ ] ⚠️ 政治事件
- [ ] ⚠️ 事件日历界面
- [ ] ⚠️ 手动添加事件功能
- [ ] ⚠️ 事件前后交易对比分析
- [ ] ⚠️ 事件详情页

### 7.2 增强分析功能
- [ ] ⚠️ 风险管理指标完整实现
  - [ ] ⚠️ 夏普比率、索提诺比率、卡玛比率
  - [ ] ⚠️ 最大回撤期
- [ ] ⚠️ 对比分析功能
  - [ ] ⚠️ 与基准指数对比（SPY, QQQ）
  - [ ] ⚠️ 与上一周期对比
  - [ ] ⚠️ 同比/环比分析
- [ ] ⚠️ 更复杂的交易配对逻辑（分批建仓/平仓）
- [ ] ⚠️ 行业/板块分类和分析

### 7.3 增强 AI 功能
- [ ] ⚠️ 完整的 AI 对话功能（RAG + LLM）
  - [ ] ⚠️ 选择向量数据库（ChromaDB / Pinecone）
  - [ ] ⚠️ 交易数据向量化
  - [ ] ⚠️ 实现 RAG 检索
  - [ ] ⚠️ 支持趋势分析问题
  - [ ] ⚠️ 支持模式识别问题
  - [ ] ⚠️ 支持原因探索问题
- [ ] ⚠️ 模式识别算法
  - [ ] ⚠️ 时间模式识别（星期几效应、月初月末效应）
  - [ ] ⚠️ 连续性模式（连胜/连亏分析）
  - [ ] ⚠️ 追涨杀跌模式识别
  - [ ] ⚠️ 情绪化交易检测
- [ ] ⚠️ 动态生成图表响应

### 7.4 用户交互增强
- [ ] ⚠️ 用户标注功能
  - [ ] ⚠️ 交易笔记编辑
  - [ ] ⚠️ 自定义标签
  - [ ] ⚠️ 交易评分
- [ ] ⚠️ 自定义时间段分析功能
- [ ] ⚠️ 报告导出（PDF）
- [ ] ⚠️ 数据导出功能

### 7.5 数据增强
- [ ] ⚠️ 集成实时行情数据 API
  - [ ] ⚠️ 选择行情数据源（Yahoo Finance / Alpha Vantage）
  - [ ] ⚠️ 未实现盈亏计算
  - [ ] ⚠️ 技术指标计算（RSI、MACD 等）
- [ ] ⚠️ 集成财报数据
- [ ] ⚠️ 集成新闻数据（用于事件识别）

---

## Phase 8: 未来规划（长期）

### 8.1 Web 应用迁移
- [ ] ⚠️ 前端开发（React / Vue.js）
- [ ] ⚠️ 后端 API 开发（FastAPI）
- [ ] ⚠️ 数据库迁移（SQLite → PostgreSQL）
- [ ] ⚠️ 部署到云服务器

### 8.2 高级功能
- [ ] ⚠️ 实时交易监控和提醒
- [ ] ⚠️ 策略回测功能
- [ ] ⚠️ 多账户支持
- [ ] ⚠️ 社区分享和对比

### 8.3 移动端
- [ ] ⚠️ 移动端应用开发

---

## 🎯 当前优先级（按开发顺序）

### Week 1-2: 数据基础
1. 项目初始化和依赖安装
2. 数据导入模块开发
3. 数据清洗和标准化
4. 数据库设计和创建
5. 交易配对逻辑实现

### Week 3-4: 核心分析
1. 基础盈亏指标计算
2. 交易行为分析
3. 费用分析
4. 标的分析
5. 时间序列分析

### Week 5-6: 基础 UI
1. Streamlit 应用搭建
2. 仪表盘页面
3. 数据可视化实现
4. 交易列表页面

### Week 7-8: 报告功能
1. 周期性报告开发
2. 单笔交易详情页
3. 基于规则的洞察生成
4. MVP 测试和优化

---

## 📝 开发注意事项

### 数据处理
- CSV 文件使用 `encoding='utf-8-sig'` 读取
- 注意处理中文字段名
- 处理日期时区（交易时间需要考虑美股交易时间）
- 金额统一为 USD
- 处理期权和股票的差异

### 代码规范
- 使用 Python 3.10+
- 遵循 PEP 8 编码规范
- 编写单元测试（pytest）
- 编写文档字符串
- Git commit message 使用中文或英文，保持一致

### 测试
- 每个模块编写单元测试
- 使用真实数据测试
- 边界条件测试
- 性能测试（大数据量）

### 安全和隐私
- 本地运行，不上传云端
- 如使用 LLM API，脱敏处理敏感数据
- .env 文件存储 API key
- .gitignore 忽略敏感文件

---

## 📊 进度跟踪

**当前阶段**: Phase 1 - 基础设施和数据层
**完成度**: 0%
**下一个里程碑**: 完成数据导入和清洗模块

**更新日志**:
- 2025-11-12: 创建 TODO.md，基于 PRD v1.0 拆解任务

---

## ❓ 待决定的问题

1. **图表库选择**: Plotly vs Altair vs ECharts？
   - 建议：Plotly（交互性好，文档完善）

2. **LLM API 选择**: OpenAI GPT-4 vs Anthropic Claude？
   - 建议：Anthropic Claude（更适合分析任务）

3. **行情数据源**: Yahoo Finance vs Alpha Vantage vs 其他？
   - 建议：Yahoo Finance（免费，覆盖广）

4. **部署方式**: 纯本地 vs Docker 容器 vs 云部署？
   - MVP: 纯本地 Streamlit
   - 长期: Docker 容器化

---

**文档结束**
