# TradingCoach 数据质量报告

**生成时间**: 2026-01-05 17:53
**数据库**: data/tradingcoach.db

---

## 执行摘要

| 指标 | 数值 |
|------|------|
| 健康状态 | **HEALTHY** |
| 综合评分 | **100.0** |
| 总记录数 | 32 |
| 异常数量 | 13 |
| 严重问题 | 0 |
| 高危问题 | 0 |

---

## 表级质量指标

### 1. 交易表 (trades)

| 指标 | 数值 |
|------|------|
| 记录数 | 20 |
| 质量等级 | **EXCELLENT** |
| 综合评分 | 100.0 |
| 完整性 | 100.0% |
| 准确性 | 100.0% |
| 一致性 | 100.0% |
| 数据新鲜度 | 9102.6 小时前 |
| 重复记录 | 0 |
| 异常值 | 0 |

**必填字段空值检查**:

| 字段 | 空值数 | 状态 |
|------|--------|------|
| symbol | 0 | ✅ |
| direction | 0 | ✅ |
| filled_quantity | 0 | ✅ |
| filled_price | 0 | ✅ |
| filled_time | 0 | ✅ |

---

### 2. 持仓表 (positions)

| 指标 | 数值 |
|------|------|
| 记录数 | 12 |
| 质量等级 | **EXCELLENT** |
| 综合评分 | 100.0 |
| 完整性 | 100.0% |
| 准确性 | 100.0% |
| 一致性 | 100.0% |
| 数据新鲜度 | 241.8 小时前 |
| 异常值 | 0 |

**必填字段空值检查**:

| 字段 | 空值数 | 状态 |
|------|--------|------|
| symbol | 0 | ✅ |
| direction | 0 | ✅ |
| status | 0 | ✅ |
| open_price | 0 | ✅ |
| open_time | 0 | ✅ |
| quantity | 0 | ✅ |

---

## 异常详情

### 异常统计

| 严重程度 | 数量 |
|----------|------|
| 严重 (Critical) | 0 |
| 高危 (High) | 0 |
| 中等 (Medium) | 12 |
| 低危 (Low) | 1 |

| 异常类型 | 数量 |
|----------|------|
| 数据不一致 (inconsistent_data) | 12 |
| 异常值 (outlier_value) | 1 |

### 异常详情列表

#### 中等级别异常 (Medium)

| 记录ID | 表 | 字段 | 描述 |
|--------|----|----|------|
| 3 | positions | trade_count | 已平仓持仓 3 (000858) 关联交易数不足: 1 |
| 5 | positions | trade_count | 已平仓持仓 5 (600036) 关联交易数不足: 1 |
| 6 | positions | trade_count | 已平仓持仓 6 (601318) 关联交易数不足: 1 |
| 9 | positions | trade_count | 已平仓持仓 9 (002594) 关联交易数不足: 1 |
| 3 | positions | quantity | 持仓 3 (000858) 买卖数量不匹配 |
| 4 | positions | quantity | 持仓 4 (000858) 买卖数量不匹配 |
| 5 | positions | quantity | 持仓 5 (600036) 买卖数量不匹配 |
| 6 | positions | quantity | 持仓 6 (601318) 买卖数量不匹配 |
| 7 | positions | quantity | 持仓 7 (601318) 买卖数量不匹配 |
| 9 | positions | quantity | 持仓 9 (002594) 买卖数量不匹配 |
| 10 | positions | quantity | 持仓 10 (002594) 买卖数量不匹配 |
| 12 | positions | quantity | 持仓 12 (600036) 买卖数量不匹配 |

#### 低级别异常 (Low)

| 记录ID | 表 | 字段 | 描述 |
|--------|----|----|------|
| 1 | positions | net_pnl | 持仓 1 (600519) 盈亏为统计异常值: $6717.25 |

---

## 异常分析

### 买卖数量不匹配

**影响范围**: 8 条持仓记录

**可能原因**:
1. 部分平仓交易 - 持仓可能分批平仓，当前只匹配了部分交易
2. A股特殊规则 - A股 T+1 交易规则可能导致开仓和平仓分多日完成
3. 数据导入不完整 - 可能有部分交易记录未导入

**建议处理**:
- 检查原始交易记录是否完整导入
- 确认持仓配对逻辑是否正确处理分批交易
- 对于确认无误的记录，可标记为"已知差异"

### 关联交易数不足

**影响范围**: 4 条已平仓记录

**可能原因**:
1. 开仓/平仓交易合并 - 部分交易可能在导入时被合并
2. 配对算法限制 - FIFO 算法可能未完全匹配所有相关交易

**建议处理**:
- 复核受影响持仓的交易历史
- 考虑手动补充关联交易

### 盈亏异常值

**影响范围**: 1 条记录 (600519 贵州茅台)

**分析**:
- 盈亏 $6717.25 被标记为统计异常值
- 这是使用 IQR (四分位距) 方法检测的
- 鉴于 600519 是高价股，此盈亏金额可能是正常交易结果

**建议处理**:
- 无需修复，属于正常业务数据
- 异常检测阈值可针对高价股进行调整

---

## 质量等级说明

| 等级 | 分数范围 | 说明 |
|------|----------|------|
| EXCELLENT | 95%+ | 数据质量优秀，可放心使用 |
| GOOD | 85-95% | 数据质量良好，少量问题 |
| FAIR | 70-85% | 数据质量一般，需要关注 |
| POOR | 50-70% | 数据质量较差，建议修复 |
| CRITICAL | <50% | 数据质量严重问题，必须修复 |

---

## 数据质量检查项

### 已实施的检查

| 类别 | 检查项 | 状态 |
|------|--------|------|
| **完整性** | 必填字段空值检查 | ✅ |
| **完整性** | 关键字段覆盖率 | ✅ |
| **准确性** | 数值范围验证 | ✅ |
| **准确性** | 价格合理性检查 | ✅ |
| **一致性** | 外键引用完整性 | ✅ |
| **一致性** | 买卖数量匹配 | ✅ |
| **一致性** | 跨表数据一致性 | ✅ |
| **唯一性** | 重复记录检测 | ✅ |
| **时效性** | 数据新鲜度 | ✅ |
| **异常检测** | 统计异常值 (IQR) | ✅ |

### 自动修复功能

| 修复项 | 说明 | 状态 |
|--------|------|------|
| 重复交易删除 | 保留最早记录，删除重复 | ✅ 可用 |
| 无效外键清理 | 清除无效 position_id | ✅ 可用 |
| 评分范围修正 | 限制在 0-100 范围 | ✅ 可用 |
| 净盈亏重算 | net_pnl = realized_pnl - fees | ✅ 可用 |
| 持仓天数重算 | 基于开平仓时间计算 | ✅ 可用 |

---

## 运行命令

```bash
# 检查数据质量
python scripts/check_data_quality.py

# 输出 JSON 格式
python scripts/check_data_quality.py --json

# 预览自动修复
python scripts/check_data_quality.py --fix

# 应用自动修复
python scripts/check_data_quality.py --fix --apply

# 追踪数据血缘
python scripts/check_data_quality.py --trace 123

# 查看导入历史
python scripts/check_data_quality.py --history
```

---

## 结论

数据质量整体 **HEALTHY**，综合评分 **100.0**。

- ✅ 无严重或高危问题
- ✅ 所有必填字段完整
- ✅ 无重复记录
- ⚠️ 12 条中等级别不一致问题 (买卖配对相关)
- ⚠️ 1 条低级别统计异常 (正常业务数据)

**建议**:
1. 定期运行数据质量检查 (建议每周)
2. 关注买卖数量不匹配问题，复核交易记录完整性
3. 统计异常检测仅作为参考，高价股的大额盈亏是正常现象

